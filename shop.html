<!DOCTYPE html>
<html lang="en">
<head>
  <title>EDA</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="apple-touch-icon" href="assets/img/logo_01.png" />
  <link rel="shortcut icon" type="image/x-icon" href="assets/img/logo_01.png" />

  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/templatemo.css" />
  <link rel="stylesheet" href="assets/css/custom.css" />
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap" />
  <link rel="stylesheet" href="assets/css/fontawesome.min.css" />

  <style>
    /* --- UI Polishing --- */
    .product-color-dot{width:12px;height:12px;display:inline-block;border:1px solid rgba(0,0,0,.15)}
    .color-dot-red{background:#e74c3c}.color-dot-blue{background:#2980b9}.color-dot-black{background:#2c3e50}
    .color-dot-light{background:#ecf0f1}.color-dot-green{background:#f0dc82}
    .category-nav{overflow-x:auto;white-space:nowrap;margin-bottom:1rem;border-bottom:1px solid #ddd;padding-bottom:.5rem;}
    .category-link{display:inline-block;padding:.4rem .8rem;margin-right:.4rem;border-radius:.4rem;text-decoration:none;color:#212529;}
    .category-link:hover{background:#f1f3f5;}
    .category-link.active{background:#f0dc82;color:#111154;}
    .product-overlay,.card-img-overlay{display:none!important;pointer-events:none!important;}
    .filter-badge{cursor:pointer;border:1px solid #ccc;padding:.3em .6em;border-radius:.35rem;margin-right:.3em;}
    .filter-badge.active{background:#f0dc82;color:#111154;border-color:#f0dc82}
  </style>
</head>

<script>
document.addEventListener('DOMContentLoaded', () => {
  (async () => {
    const placeholders = document.querySelectorAll('[data-include]');
    for (const el of placeholders) {
      const url = el.getAttribute('data-include');
      try {
        const res = await fetch(url, { cache: 'no-cache' });
        if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
        const html = await res.text();

        const tmp = document.createElement('div');
        tmp.innerHTML = html;

        // Make <script> tags inside partials execute
        for (const oldScript of tmp.querySelectorAll('script')) {
          const s = document.createElement('script');
          if (oldScript.src) s.src = oldScript.src;
          else s.textContent = oldScript.textContent;
          document.body.appendChild(s);
          oldScript.remove();
        }

        el.replaceWith(...tmp.childNodes);
      } catch (e) {
        console.error('Include failed:', url, e);
        el.innerHTML = `<!-- include failed: ${url} -->`;
      }
    }
  })();
});
</script>

<body>
    <!-- Top Nav -->
    <div data-include="partials/top_nav.html"></div>

    <!-- Header -->
    <div data-include="partials/header.html"></div>

    <!-- Start Search Bar -->
    <div data-include="partials/search-bar.html"></div>
    <!-- Close Search Bar -->

  <!-- ===== MAIN ===== -->
  <div class="container py-5">
    <div class="row">

      <!-- ===== Left Filter Sidebar ===== -->
      <aside class="col-lg-3">
        <h3 class="h4 mb-3">Filters</h3>

        <div class="mb-3">
          <label class="form-label fw-bold">Sort by</label>
          <select class="form-control" id="sort-select">
            <option>Featured</option>
            <option>Price: Low to High</option>
            <option>Price: High to Low</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-bold">Condition</label><br>
          <span class="filter-badge" data-filter-condition="new">New</span>
          <span class="filter-badge" data-filter-condition="used">Used</span>
        </div>

        <button id="clear-filters" class="btn btn-outline-secondary btn-sm mt-2">Clear Filters</button>
      </aside>

      <!-- ===== Right Section ===== -->
      <section class="col-lg-9">
        <!-- Categories horizontal nav -->
        <div class="category-nav" id="category-nav"></div>

        <h3 class="h3 mb-4" id="current-category-title">All Products</h3>
        <div class="row" id="products-grid" aria-live="polite"></div>

        <!-- Pagination -->
        <div class="row mt-4">
          <nav aria-label="Products pagination">
            <ul class="pagination pagination-lg justify-content-end" id="pager"></ul>
          </nav>
        </div>
      </section>
    </div>
  </div>

  <!-- Footer -->
  <div data-include="partials/footer.html"></div>
  <div data-include="partials/scripts.html"></div>

  <!-- ====== PRODUCTS DATA (EDIT HERE to add products) ====== -->
  <script type="application/json" id="products-data">
  [
    {
        "id":"p1",
        "title":"Silk Evening Dress",
        "image":"assets/img/shop_01.jpg",
        "sizes":["S","M","L"],
        "colors":["red","black","light"],
        "price":250,
        "condition":"new",
        "category":"Evening Dress"
    },
    {
        "id":"p2",
        "title":"Classic Wedding Gown",
        "image":"assets/img/shop_02.jpg",
        "sizes":["M","L","XL"],
        "colors":["light","white","black"],
        "price":790,
        "condition":"new",
        "category":"Wedding Dress"
    },
    {
        "id":"p3",
        "title":"Vintage Lace Dress",
        "image":"assets/img/shop_03.jpg",
        "sizes":["M","L","XL"],
        "colors":["green","black"],
        "price":180,
        "condition":"used",
        "category":"Classic Dress"
    },
    {
        "id":"p4",
        "title":"Minimalist Day Dress",
        "image":"assets/img/shop_04.jpg",
        "sizes":["S","M"],
        "colors":["blue","light"],
        "price":120,
        "condition":"used",
        "category":"Scarf"
    },
    {
        "id":"p5",
        "title":"Embroidered Party Dress",
        "image":"assets/img/shop_05.jpg",
        "sizes":["M","L"],
        "colors":["red","green","black"],
        "price":320,
        "condition":"new",
        "category":"Evening Dress"
    },
    {
        "id":"p6",
        "title":"Silk Evening Dress",
        "image":"assets/img/shop_01.jpg",
        "sizes":["S","M","L"],
        "colors":["red","black","light"],
        "price":250,
        "condition":"new",
        "category":"Evening Dress"
    },
    {
        "id":"p7",
        "title":"Classic Wedding Gown",
        "image":"assets/img/shop_02.jpg",
        "sizes":["M","L","XL"],
        "colors":["light","white","black"],
        "price":790,
        "condition":"new",
        "category":"Wedding Dress"
    },
    {
        "id":"p8",
        "title":"Vintage Lace Dress",
        "image":"assets/img/shop_03.jpg",
        "sizes":["M","L","XL"],
        "colors":["green","black"],
        "price":180,
        "condition":"used",
        "category":"Classic Dress"
    },
    {
        "id":"p9",
        "title":"Minimalist Day Dress",
        "image":"assets/img/shop_04.jpg",
        "sizes":["S","M"],
        "colors":["blue","light"],
        "price":120,
        "condition":"used",
        "category":"Classic Dress"
    },
    {
        "id":"p10",
        "title":"Embroidered Party Dress",
        "image":"assets/img/shop_05.jpg",
        "sizes":["M","L"],
        "colors":["red","green","black"],
        "price":320,
        "condition":"new",
        "category":"Evening Dress"
    }
  ]
  </script>

  <!-- ====== ONE CLEAN SCRIPT (partials loader + URL state + shop logic) ====== -->
  <script>
  (function(){
    // ---------- Partials loader ----------
    document.addEventListener('DOMContentLoaded', () => {
      (async () => {
        const placeholders = document.querySelectorAll('[data-include]');
        for (const el of placeholders) {
          const url = el.getAttribute('data-include');
          try {
            const res = await fetch(url, { cache: 'no-cache' });
            if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
            const html = await res.text();
            const tmp = document.createElement('div');
            tmp.innerHTML = html;

            // Execute scripts in partials
            for (const oldScript of tmp.querySelectorAll('script')) {
              const s = document.createElement('script');
              if (oldScript.src) s.src = oldScript.src;
              else s.textContent = oldScript.textContent;
              document.body.appendChild(s);
              oldScript.remove();
            }
            el.replaceWith(...tmp.childNodes);
          } catch (e) {
            console.error('Include failed:', url, e);
          }
        }
      })();
    });

    // ---------- Shop logic ----------
    const grid       = () => document.getElementById('products-grid');
    const pager      = () => document.getElementById('pager');
    const titleEl    = () => document.getElementById('current-category-title');
    const sortSelect = () => document.getElementById('sort-select');
    const categoryNav= () => document.getElementById('category-nav');
    const clearBtn   = () => document.getElementById('clear-filters');

    const products   = JSON.parse(document.getElementById('products-data').textContent.trim());
    const categories = ['All', ...new Set(products.map(p => p.category))];
    const pageSize   = 9;

    let selectedCategory = 'All';
    let conditions       = new Set();
    let currentPage      = 1;
    let query            = '';

    // Build category nav
    function buildCategoryNav() {
      categoryNav().innerHTML = categories.map(cat =>
        `<a href="#" class="category-link${cat==='All'?' active':''}" data-category="${cat}">${cat}</a>`
      ).join('');
    }

    // Card HTML
    function cardHtml(p){
      const sizes=(p.sizes||[]).join('/');
      const colors=(p.colors||[]).map(c=>`<span class="product-color-dot color-dot-${c} rounded-circle ms-1"></span>`).join('');
      return `<div class="col-md-4">
        <div class="card mb-4 product-wap rounded-0">
          <img class="card-img rounded-0 img-fluid" src="${p.image}" alt="${p.title}">
          <div class="card-body">
            <a href="#" class="h4 text-decoration-none">${p.title}</a>
            <ul class="list-unstyled d-flex justify-content-between mb-0">
              <li>${sizes}</li><li>${colors}</li>
            </ul>
            <p style="color:#111154;" class="text-center mb-0">$${Number(p.price).toFixed(2)}</p>
          </div>
        </div>
      </div>`;
    }

    // Filter + sort + search
    function filteredProducts(){
      let arr = [...products];

      if (query && selectedCategory !== 'All') selectedCategory = 'All';
      if (selectedCategory !== 'All') arr = arr.filter(p => p.category === selectedCategory);
      if (conditions.size) arr = arr.filter(p => conditions.has(p.condition));

      const q = (query || '').trim().toLowerCase();
      if (q) {
        arr = arr.filter(p => {
          const bucket = [
            p.title,
            p.category,
            ...(p.sizes||[]),
            ...(p.colors||[])
          ].join(' ').toLowerCase();
          return bucket.includes(q);
        });
      }

      const s = sortSelect().value;
      if (s === 'Price: Low to High')  arr.sort((a,b)=> Number(a.price) - Number(b.price));
      if (s === 'Price: High to Low')  arr.sort((a,b)=> Number(b.price) - Number(a.price));
      return arr;
    }

    // Render
    function render(){
      const arr   = filteredProducts();
      const pages = Math.ceil(arr.length / pageSize) || 1;
      if (currentPage > pages) currentPage = pages;

      const slice = arr.slice((currentPage - 1) * pageSize, currentPage * pageSize);

      titleEl().textContent =
        (query && query.trim())
          ? `Results for "${query.trim()}"`
          : (selectedCategory === 'All' ? 'All Products' : selectedCategory);

      grid().innerHTML = slice.map(cardHtml).join('') ||
        `<div class="p-5 text-center text-muted">No products found.</div>`;

      pager().innerHTML = Array.from({length: pages}, (_,i) =>
        `<li class="page-item${i+1===currentPage?' active':''}">
           <a class="page-link" href="#" data-page="${i+1}">${i+1}</a>
         </li>`).join('');

      highlightCategories();
      highlightFilters();
    }

    function highlightCategories(){
      document.querySelectorAll('.category-link').forEach(a=>{
        a.classList.toggle('active', a.dataset.category === selectedCategory && !query);
      });
    }
    function highlightFilters(){
      document.querySelectorAll('[data-filter-condition]').forEach(b=>{
        b.classList.toggle('active', conditions.has(b.dataset.filterCondition));
      });
    }

    // Read URL (category or q)
    function applyInitialStateFromURL(){
      const params = new URLSearchParams(window.location.search);
      const fromCategory = params.get('category');
      const fromQuery    = params.get('q');

      if (fromQuery) {
        query = fromQuery;
        selectedCategory = 'All';
      } else if (fromCategory && categories.includes(fromCategory)) {
        selectedCategory = fromCategory;
      }

      // prefill search inputs (if present)
      const modalInput  = document.getElementById('inputModalSearch');
      const mobileInput = document.getElementById('inputMobileSearch');
      if (modalInput && fromQuery)  modalInput.value = fromQuery;
      if (mobileInput && fromQuery) mobileInput.value = fromQuery;
    }

    // Live search on shop page (progressive enhancement)
    function wireSearchInput(){
      const container = document.querySelector('[data-include="partials/search-bar.html"]') || document;
      const input = container.querySelector('#inputMobileSearch, #inputDesktopSearch, input[name="q"], input[type="search"]');

      if (!input) return;
      if (query) input.value = query;

      input.addEventListener('input', () => {
        query = input.value || '';
        if (query.trim()) selectedCategory = 'All';
        currentPage = 1;
        render();
      });
    }

    // Events
    document.addEventListener('click', e => {
      const cat = e.target.closest('.category-link');
      if (cat){
        e.preventDefault();
        selectedCategory = cat.dataset.category;
        query = ''; // clear search on category pick
        currentPage = 1;
        render();
      }

      const page = e.target.closest('[data-page]');
      if (page){
        e.preventDefault();
        currentPage = +page.dataset.page;
        render();
        window.scrollTo({ top: grid().offsetTop - 80, behavior: 'smooth' });
      }

      const cond = e.target.closest('[data-filter-condition]');
      if (cond){
        const v = cond.dataset.filterCondition;
        conditions.has(v) ? conditions.delete(v) : conditions.add(v);
        currentPage = 1;
        render();
      }
    });

    // Also react if a search form with name="q" is used (modal submit avoidance on-page)
    document.addEventListener('input', (e)=>{
      if (e.target && e.target.name === 'q') {
        query = e.target.value || '';
        currentPage = 1;
        render();
      }
    });

    // Boot
    document.addEventListener('DOMContentLoaded', ()=>{
      buildCategoryNav();
      applyInitialStateFromURL();
      wireSearchInput();
      render();
    });

    sortSelect().addEventListener('change', ()=>{ currentPage = 1; render(); });
    clearBtn().addEventListener('click', ()=>{
      conditions.clear();
      query = '';
      selectedCategory = 'All';
      currentPage = 1;
      render();
    });
  })();
  </script>
</body>
</html>
